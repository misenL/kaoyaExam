(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["goodsdetail"],{"23fe":function(t,s,e){},"4cd1":function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",[a("div",{staticClass:"lostListTop"},[a("div",{staticClass:"lostTab"},[a("van-tabs",{attrs:{animated:"",background:"#003366",color:"#ffffff","title-active-color":"#ffffff","title-inactive-color":"#ffffff"},on:{click:t.cutTab}},t._l(t.lostTab,function(s,o){return a("van-tab",{key:o,attrs:{title:s.title}},[1===s.value?a("div",t._l(t.lostList,function(s,o){return a("div",{key:o,staticClass:"lostListContent",on:{click:function(e){return t.tabToDetail(s.id)}}},[a("p",[t._v(t._s(s.goods_name))]),a("p",[t._v(t._s(s.goods_describle))]),a("div",{staticClass:"lostListUserInfo"},[s.student_info?a("span",{staticClass:"userInfo"},[""!==s.student_info.headpic?a("img",{attrs:{src:s.student_info.headpic,alt:""}}):a("img",{attrs:{src:e("c127"),alt:""}}),t._v("\n                                    "+t._s(s.username)+"\n                                ")]):t._e(),a("span",{staticClass:"seatLine"}),a("span",{staticClass:"pushDate"},[t._v("\n                                    "+t._s(s.create_time)+"\n                                ")])])])}),0):2===s.value?a("div",[a("div",{staticClass:"lostReceive"},[a("p",{staticClass:"lostNoticeP"},[t._v("\n                              遗失物品公告\n                          ")]),a("div",{staticClass:"lostGoods"},[a("p",{staticClass:"fontStyle"},[t._v("恰得物品及数量")]),a("ul",t._l(t.lostNoticeList,function(s,e){return a("li",{key:e},[a("span",[t._v(t._s(s.title))]),a("span",[t._v("("+t._s(s.number)+")")])])}),0)]),a("div",{staticClass:"receivePlace"},[a("p",{staticClass:"fontStyle"},[t._v("领取地点、工作时间及联系电话")]),a("div",[a("span",[t._v(t._s(t.receivePlace.notice+t.receivePlace.lostandfound_location))]),a("span",[t._v(t._s(t.receivePlace.lostandfound_work_time))]),a("span",[t._v(t._s(t.receivePlace.lostandfound_tel))])])])])]):t._e()])}),1)],1),a("div",{staticClass:"lostEdit",on:{click:t.toPublish}},[a("i",{staticClass:"el-icon-edit-outline"}),a("span",[t._v("发布")])])])])},o=[],i={data:function(){return{urlQuery:"",lostTab:[{title:"报失",value:1},{title:"招领",value:2}],lostList:[],lostNoticeList:[{title:"文件",number:0},{title:"电子产品",number:0},{title:"医疗用品",number:0},{title:"证件",number:0},{title:"背包",number:0},{title:"银行卡",number:0},{title:"现金",number:0},{title:"书籍",number:0},{title:"钥匙",number:0},{title:"手表",number:0},{title:"雨伞",number:0},{title:"水杯",number:0},{title:"其他",number:0}],receivePlace:{}}},created:function(){var t=this;this.urlQuery=this.$cookies.get("examInfo"),console.log("urlQuery:",this.urlQuery);var s="/api/lostandfound/getgoodslist?class=1&school_id=".concat(this.urlQuery.school_id);this.axios.get(s).then(function(s){s=s.data,0===s.code&&(console.log(s),t.lostList=s.data)}).catch(function(s){t.$notify(res.msg)});var e="/api/lostandfound/school_lostandfound_location?school_id=".concat(this.urlQuery.school_id);this.axios.get(e).then(function(s){s=s.data,0===s.code&&(console.log("位置：",s),t.receivePlace=s.data)}).catch(function(s){t.$notify(res.msg)})},methods:{cutTab:function(t,s){var e=this;console.log("index:",t,"title:",s),console.log("this.lostList: ",this.lostList);var a="/api/lostandfound/getgoodslist?class=".concat(t+1,"&school_id=").concat(this.urlQuery.school_id);this.axios.get(a).then(function(s){if(s=s.data,0===s.code)if(0===t)console.log("index = 0:",s),e.lostList=s.data;else if(1===t){var a=s.data.map;console.log("index = 1:",a),e.lostNoticeList.map(function(t,s){t.number=a[s].count})}}).catch(function(t){e.$notify(res.msg)})},tabToDetail:function(t){console.log("lostId:",t),this.$router.push({path:"lostList/lostDetail",query:{goods_id:t}})},toPublish:function(){this.$router.push({path:"lostList/lostPublish"})}}},l=i,n=(e("839c"),e("2877")),c=Object(n["a"])(l,a,o,!1,null,"629aae68",null);s["default"]=c.exports},"7f7f":function(t,s,e){var a=e("86cc").f,o=Function.prototype,i=/^\s*function ([^ (]*)/,l="name";l in o||e("9e1e")&&a(o,l,{configurable:!0,get:function(){try{return(""+this).match(i)[1]}catch(t){return""}}})},"81a7":function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"lostDetailParent"},[""!==t.lostDetail.goods_picture?a("img",{staticClass:"lostDetailImg",attrs:{src:t.lostDetail.goods_picture,alt:""},on:{click:t.imgPreview}}):a("img",{staticClass:"lostDetailImg",attrs:{src:e("c127"),alt:""}}),a("div",{staticClass:"lostDetailTop"},[a("p",[t._v(t._s(t.lostDetail.goods_name))]),a("div",[a("span",{staticClass:"lostDetailUserInfo"},[t.lostDetail.student_info?a("img",{attrs:{src:t.lostDetail.student_info.headpic,alt:""}}):a("img",{attrs:{src:e("c127"),alt:""}}),t._v("\r\n                    "+t._s(t.lostDetail.lostUserName)+"\r\n                ")]),a("span",{staticClass:"lineCenter"}),a("span",{staticClass:"lostDetailDate"},[t._v(t._s(t.lostDetail.create_time))])])]),a("div",{staticClass:"lostDetailCenter"},[t._m(0),a("p",[t._v(t._s(t.lostDetail.goods_location))]),t._m(1),a("p",[t._v(t._s(t.lostDetail.goods_describle))])]),a("div",{staticClass:"lostDetailBottom"},[t._m(2),a("p",{on:{click:t.showSheet}},[a("span",{staticClass:"lostDetailContacts"},[t._v(t._s(t.lostDetail.username))]),a("span",{staticClass:"lostTel"},[t._v(t._s(t.lostDetail.tel))]),t._m(3)])]),a("van-action-sheet",{attrs:{actions:t.actions,"cancel-text":"取消"},on:{select:t.onSelect},model:{value:t.show,callback:function(s){t.show=s},expression:"show"}})],1)},o=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[e("span",{staticClass:"lineLeft"}),t._v("\r\n                丢失地点\r\n            ")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",{staticClass:"goodsInfo"},[e("span",{staticClass:"lineLeft"}),t._v("\r\n                物品描述\r\n            ")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("p",[e("span",{staticClass:"lineLeft"}),t._v("\r\n                联系人\r\n            ")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("span",{staticClass:"lostDetailTelIcon"},[e("i",{staticClass:"el-icon-phone-outline",staticStyle:{color:"#369"}})])}],i=(e("7f7f"),e("28a2")),l={data:function(){return{lostDetail:{},userImg:"",tel:"",show:!1,actions:[{name:"",disabled:!0},{name:"拨打"}]}},created:function(){var t=this,s=this.$route.query.goods_id,e="/api/lostandfound/getgoodsdetail?goods_id=".concat(s);this.axios.get(e).then(function(s){s=s.data,0===s.code&&(t.lostDetail=s.data,t.actions[0].name=t.tel=s.data.tel)}).catch(function(s){t.$notify(res.msg)})},methods:{showSheet:function(){this.show=!0},onSelect:function(t){this.show=!1,"拨打"===t.name&&(console.log(this.tel),window.location.href="tel:"+this.tel)},imgPreview:function(){Object(i["a"])([this.lostDetail.goods_picture])}}},n=l,c=(e("ec16"),e("2877")),r=Object(c["a"])(n,a,o,!1,null,"2912e817",null);s["default"]=r.exports},"839c":function(t,s,e){"use strict";var a=e("23fe"),o=e.n(a);o.a},"91ba":function(t,s,e){},a5e4:function(t,s,e){"use strict";var a=e("91ba"),o=e.n(a);o.a},b4e5:function(t,s,e){},c127:function(t,s,e){t.exports=e.p+"img/haha.1d1806df.jpg"},c3c2:function(t,s,e){},c56d:function(t,s,e){},c75a:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"publishParent"},[a("p",{staticClass:"publishLabelP"},[a("span",{staticClass:"publishLabel"},[t._v("发布类型")]),a("span",[a("van-dropdown-menu",[a("van-dropdown-item",{attrs:{options:t.publishOptions},model:{value:t.publishLabel,callback:function(s){t.publishLabel=s},expression:"publishLabel"}})],1)],1)]),a("p",{staticClass:"publishGoodsType"},[a("span",{staticClass:"goodsType"},[t._v("物品类型")]),a("span",[a("van-dropdown-menu",[a("van-dropdown-item",{attrs:{options:t.goodsTypeOptions},model:{value:t.goodsType,callback:function(s){t.goodsType=s},expression:"goodsType"}})],1)],1)]),a("p",{staticStyle:{"border-top":"none"}},[a("van-cell-group",[a("van-field",{attrs:{error:!!t.isNull&&!t.goodsName,required:"",clearable:"",label:"物品名称",placeholder:"请填写物品名称"},model:{value:t.goodsName,callback:function(s){t.goodsName=s},expression:"goodsName"}})],1)],1),a("span",{staticClass:"leftSpan fontColorGray"},[t._v("联系人")]),a("div",{staticClass:"publishContacts"},[a("van-cell-group",[a("van-field",{attrs:{error:!!t.isNull&&!t.userName,required:"",clearable:"",label:"姓名",placeholder:"请填写真实姓名"},model:{value:t.userName,callback:function(s){t.userName=s},expression:"userName"}}),a("van-field",{attrs:{error:!!t.isNull&&(!t.userTel||!!t.isTel),type:"number",maxlength:"11",required:"",clearable:"",label:"电话",placeholder:"请填写联系电话"},model:{value:t.userTel,callback:function(s){t.userTel=s},expression:"userTel"}}),a("van-field",{attrs:{error:!!t.isNull&&!t.lostPlace,required:"",clearable:"",label:"丢失地点",placeholder:"请填写丢失地点"},model:{value:t.lostPlace,callback:function(s){t.lostPlace=s},expression:"lostPlace"}})],1)],1),a("div",{staticClass:"goodsDes"},[a("van-cell-group",[a("van-field",{attrs:{type:"textarea",clearable:"",label:"物品描述",maxlength:50,placeholder:"请填写物品描述（最多不超过50字）"},model:{value:t.goodsDes,callback:function(s){t.goodsDes=s},expression:"goodsDes"}})],1)],1),a("div",{staticClass:"upImg"},[a("span",{staticClass:"leftSpan"},[t._v("物品图片")]),a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"http://kaoya.huikaoedu.com/api/tool/uploadimg",name:"imgfile","show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[t.lostImg?a("img",{staticClass:"avatar",attrs:{src:t.lostImg}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("div",{staticClass:"publishBtn",on:{click:t.publish}},[t._v("发布")]),a("van-dialog",{staticClass:"alertContent",attrs:{showConfirmButton:""},on:{confirm:t.publishRouter},model:{value:t.lostshow,callback:function(s){t.lostshow=s},expression:"lostshow"}},[a("img",{attrs:{src:e("d4e8")}}),1===t.publishLabel?a("p",[t._v("提交成功，管理员审核通过即可发布在平台！")]):t._e(),2===t.publishLabel?a("p",[a("span",[t._v("小智为您的拾金不昧精神点赞~")]),a("span",[t._v("请将恰得物品交到")]),a("span",[a("b",[t._v(t._s(t.schoolAddress))])])]):t._e()])],1)},o=[],i={data:function(){return{publishLabel:1,publishOptions:[{text:"报失",value:1},{text:"招领",value:2}],goodsType:"文件",goodsTypeOptions:[{text:"文件",value:1},{text:"电子产品",value:2},{text:"医疗用品",value:3},{text:"证件",value:4},{text:"背包",value:5},{text:"银行卡",value:6},{text:"现金",value:7},{text:"书籍",value:8},{text:"钥匙",value:9},{text:"手表",value:10},{text:"雨伞",value:11},{text:"水杯",value:12},{text:"其他",value:13}],goodsName:"",userName:"",userTel:"",lostPlace:"",goodsDes:"",lostImg:"",student_id:0,formDate:{},isNull:!1,isTel:!1,lostshow:!1,schoolAddress:"华南理工大学大学城校区A2地区地址教学楼"}},created:function(){var t=this,s=this.$cookies.get("examInfo"),e="/api/user/info";this.axios.get(e).then(function(s){s=s.data,0===s.code&&(t.student_id=s.data.student_id,console.log(t.student_id))}).catch(function(s){t.$notify(res.msg)});var a="/api/lostandfound/school_lostandfound_location?school_id=".concat(s.school_id);this.axios.get(a).then(function(s){s=s.data,0===s.code&&(console.log("位置：",s),t.schoolAddress=s.data.notice+s.data.lostandfound_location)}).catch(function(s){t.$notify(res.msg)})},watch:{userTel:function(){return/^1[3456789]\d{9}$/.test(this.userTel)?void(this.isTel=!1):void(this.isTel=!0)}},methods:{beforeAvatarUpload:function(t){var s="image/jpeg"===t.type||"image/png"===t.type;return!!s||(this.$message.error("只能上传png或jpg格式"),!1)},handleAvatarSuccess:function(t,s){console.log("res:",t),console.log("file:",s),this.lostImg=t.data},publish:function(){var t=this,s=this.$cookies.get("examInfo").school_id;if(console.log("publish school_id:",s),this.isNull=!0,""!==this.goodsName&&""!==this.userName&&""!==this.userTel&&!this.isTel){var e="/api/lostandfound/infoupload";this.formDate={class:this.publishLabel,goods_category:this.goodsType,goods_name:this.goodsName,goods_describle:this.goodsDes,goods_location:this.lostPlace,goods_picture:this.lostImg,username:this.userName,tel:this.userTel,student_id:this.student_id,school_id:s,review:0},console.log("this.formDate:",this.formDate),this.axios.post(e,this.formDate).then(function(s){s=s.data,0===s.code&&(t.lostshow=!0)}).catch(function(s){t.$notify(res.msg)})}},publishRouter:function(){this.$router.push({path:"/goods/lostList"})}}},l=i,n=(e("d968"),e("a5e4"),e("2877")),c=Object(n["a"])(l,a,o,!1,null,"e923e9bc",null);s["default"]=c.exports},d4e8:function(t,s,e){t.exports=e.p+"img/confirmJoin.b8b2474d.png"},d968:function(t,s,e){"use strict";var a=e("c56d"),o=e.n(a);o.a},ec16:function(t,s,e){"use strict";var a=e("c3c2"),o=e.n(a);o.a},f1e6:function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t.$createElement,e=t._self._c||s;return t.goodsDetail?e("div",{staticClass:"container"},[e("div",{staticClass:"goodsDetailTop"},[e("img",{attrs:{src:t.goodsDetail.img},on:{click:t.imgPreview}}),e("p",{staticClass:"detailPrice"},[t._v("￥"+t._s(t.goodsDetail.price))]),e("p",{staticClass:"detailGoodsName"},[t._v(t._s(t.goodsDetail.item_good_name))]),e("p",{staticClass:"detailSummary"},[t._v(t._s(t.goodsDetail.summary))])]),e("div",{staticClass:"num clearfix"},[e("span",{staticClass:"fl-left"},[t._v("选择数量"),e("font",{staticClass:"fontSku"},[t._v("（库存 "+t._s(t.goodsDetail.sku_num)+"）")])],1),e("van-stepper",{staticClass:"fl-right",attrs:{max:t.goodsDetail.sku_num,integer:""},model:{value:t.num,callback:function(s){t.num=s},expression:"num"}})],1),e("div",{staticClass:"note"},[e("span",{staticClass:"header"},[t._v("服务说明：")]),e("span",{staticClass:"content"},[t._v(t._s(t.goodsDetail.service_summary))])]),t._m(0),e("van-submit-bar",{attrs:{price:t.totalPrice,"button-text":"确认支付",label:"合计："},on:{submit:t.onSubmit}}),e("van-dialog",{attrs:{title:"提交订单","show-cancel-button":"","confirm-button-text":"确认支付","confirm-button-color":"#DC1829"},on:{confirm:t.confirmSubmit},model:{value:t.showDialog,callback:function(s){t.showDialog=s},expression:"showDialog"}},[e("div",{staticClass:"content"},[e("span",[t._v("支付金额：")]),e("span",{staticClass:"color-red"},[t._v("￥"+t._s(this.totalPrice/100))])])])],1):t._e()},o=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"must-know"},[e("span",{staticClass:"header"},[t._v("购买须知：")]),e("span",{staticClass:"content"},[t._v("下单购买此商品并支付成功后，请出示订单二维码给商家进行核销，核销成功可获得服务。")])])}],i=e("bd86"),l=(e("28a5"),e("27ae")),n=e.n(l),c=e("28a2"),r=Object(i["a"])({name:"GoodsDetail",data:function(){return{id:null,goodsDetail:null,num:1,showDialog:!1}},computed:{},created:function(){this.id=this.$route.query.id,this.id&&this.getGoodsDetail()},methods:{initWx:function(){var t=this,s="api/wechat/getjssdk?url="+n.a.Base64.encode(location.href.split("#")[0]);return this.axios.get(s).then(function(s){s=s.data,t.wx.config({debug:!1,appId:s.appId,timestamp:s.timestamp,nonceStr:s.nonceStr,signature:s.signature,jsApiList:["chooseWXPay"]})}).catch(function(s){t.$notify("ERR: 微信授权失败")})},getGoodsDetail:function(){var t=this,s="/api/goods/detail?item_id="+this.id;this.axios.get(s).then(function(s){s=s.data,0===s.code?t.goodsDetail=s.data:t.$notify(s.msg)}).catch(function(s){t.$notify("ERR: 获取服务列表失败")})},onSubmit:function(){this.showDialog=!0},confirmSubmit:function(){var t=this,s=this;this.initWx().then(function(e){var a="api/order/ordercreate";t.axios.post(a,{items:[{item_id:t.goodsDetail.id,num:t.num}]}).then(function(e){if(e=e.data,0===e.code){var a=e.data.service_id;s.wx.chooseWXPay({timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign,success:function(t){window.location.href="http://kaoyafront.huikaoedu.com/service/detail?service_id="+a+"&type=success"},cancel:function(t){s.$notify("已取消支付"),window.location.href="http://kaoyafront.huikaoedu.com/goods/detail?id="+s.id},fail:function(t){s.$notify("购买失败，请重新创建订单"),window.location.href="http://kaoyafront.huikaoedu.com/goods/detail?id="+s.id}})}else t.$notify(e.msg),window.location.href="http://kaoyafront.huikaoedu.com/service/list"}).catch(function(s){t.$notify("ERR: 支付过程异常")})})},imgPreview:function(){Object(c["a"])([this.goodsDetail.img])}}},"computed",{totalPrice:function(){return 100*this.num*this.goodsDetail.price}}),u=r,d=(e("f66e"),e("2877")),f=Object(d["a"])(u,a,o,!1,null,"39946dda",null);s["default"]=f.exports},f66e:function(t,s,e){"use strict";var a=e("b4e5"),o=e.n(a);o.a}}]);